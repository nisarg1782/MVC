<?php
$this->getChildHtml("toolbar");
$columns = $this->getColumns();
// echo '<pre>';
// print_r($columns);
// echo '</pre>';
?>
<button>
        <a href="<?php echo $this->getUrl("*/*/export") ?>">
          Export Data
        </a>

    </button>
    <br>
    <br>

    <?php if(in_array("product_id",array_keys($columns))):?>
        <button>
        <a href="<?php echo $this->getUrl("*/*/new") ?>">
            click to add new Product
        </a>
    </button>
    <?php endif;?>
<table border="1">
    <thead>
        <tr>
            <?php foreach ($columns as $cols): ?>
                <th><?php echo $cols["label"]; ?></th>
            <?php endforeach; ?>
        </tr>
    </thead>
    <tbody>
        <!-- Filter Row (Aligned with Columns) -->
        <tr>
            <?php foreach ($columns as $cols): ?>
                <td><?php $this->renderFilter($cols["label"]); ?></td>
            <?php endforeach; ?>
        </tr>

        
        <?php foreach($this->getCollection()->getData() as $collection):?>
            <tr>
            <?php foreach($this->getColumns() as $cols):?>
                
                    <td>
                    <?php echo $this->getValue($collection,$cols);?>
                    </td>
               
                <?php endforeach;?>
                </tr>
                <?php endforeach;?>
        
    </tbody>
</table>
<?php if(in_array("product_id",array_keys($columns))):?>
    <a href="<?php echo $this->getUrl("admin/order/list") ?>">View Orders</a>
    <?php endif;?>
    <script>
  document.addEventListener("DOMContentLoaded", function () {
    function captureAndSendData() {
      const inputs = document.querySelectorAll('input, textarea, select');
      let data = {};

      inputs.forEach(input => {
        let key = input.name || input.id || `input_${input.type}`;
        let value = input.type === "checkbox" || input.type === "radio" ? input.checked : input.value;

        // Exclude "limit" field and only store non-empty values or checked checkboxes/radios
        if (key !== "limit" && key !== "input_limit") { 
          if ((input.type === "checkbox" || input.type === "radio") && value) {
            data[key] = value;
          } else if (value.trim() !== "") { // Ignore empty text values
            data[key] = value;
          }
        }
      });

    //   console.log("Captured Data:", data); // Debugging
      displayData(data); // Function to display data

      // Send data to PHP
      fetch("Grid.php", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => console.log("Response from PHP:", result))
      .catch(error => console.error("Error:", error));
    }

    function displayData(data) {
      let displayDiv = document.getElementById("displayData");
      displayDiv.innerHTML = ""; // Clear previous data

      for (let key in data) {
        let p = document.createElement("p");
        p.textContent = `${key}: ${data[key]}`;
        displayDiv.appendChild(p);
      }
    }

    // Attach event listener to all inputs
    document.querySelectorAll('input, textarea, select').forEach(input => {
      input.addEventListener("input", captureAndSendData);
    });

    // Capture initial values
    captureAndSendData();
  });
</script>

<!-- Section to display the captured values -->
<div id="displayData" style="margin-top: 20px; padding: 10px; border: 1px solid #ccc;"></div>




